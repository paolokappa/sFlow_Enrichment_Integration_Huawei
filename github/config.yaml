# sFlow Enricher Configuration v2.2
# Proxy that enriches sFlow packets with ASN information

# Listen address for incoming sFlow
listen:
  address: "0.0.0.0"
  port: 6343

# HTTP API for metrics and status
http:
  enabled: true
  address: "127.0.0.1"  # localhost only for security
  port: 8080
  # Endpoints:
  #   /metrics - Prometheus metrics
  #   /status  - JSON status
  #   /health  - Health check (OK/DEGRADED)

# Destinations to forward enriched sFlow
destinations:
  - name: "primary-collector"
    address: "198.51.100.1"
    port: 6343
    enabled: true
    primary: true
    # failover: "backup-collector"  # Optional: name of failover destination

  - name: "secondary-collector"
    address: "198.51.100.2"
    port: 6343
    enabled: true
    primary: true

# ASN enrichment rules
# Enriches: SrcAS, SrcPeerAS, RouterAS (in-place) and DstAS (XDR insert)
# If src_ip matches network and src_as equals 'match_as', replace with 'set_as'
enrichment:
  rules:
    - name: "my-network-ipv4"
      network: "203.0.113.0/24"
      match_as: 0          # Only enrich if current AS is 0
      set_as: 64512
      overwrite: false     # Don't overwrite if AS already set

    - name: "my-network-ipv6"
      network: "2001:db8::/32"
      match_as: 0
      set_as: 64512
      overwrite: false

# Security settings
security:
  whitelist_enabled: true
  whitelist_sources:
    - "10.0.0.1"           # Router IP
    # - "10.0.0.0/8"       # Add more sources as needed

# Logging configuration
logging:
  level: "info"           # debug, info, warn, error
  format: "text"          # "text" or "json" (for ELK/Loki)
  stats_interval: 60      # seconds between stats output

# Telegram notifications (optional)
telegram:
  enabled: false
  bot_token: ""           # Get from @BotFather
  chat_id: ""             # Your chat/group ID
  alert_on:
    - "startup"
    - "shutdown"
    - "destination_down"
    - "destination_up"
    # - "high_drop_rate"
  # drop_rate_threshold: 5.0   # Drop rate % to trigger high_drop_rate alert (default: 5.0)
  # http_timeout: 15           # HTTP request timeout in seconds (default: 15)
  # flap_cooldown: 300         # Seconds between alerts for same destination (default: 300)
  # ipv6_fallback: false       # Try IPv6 first, fallback to IPv4 if it fails (default: false)
